---
layout: post
title: Notes on Go - Go-kit for a Java programmer
date: '2017-11-01T11:38:00.001+01:00'
author: John
tags: 
modified_time: '2017-11-01T11:38:08.165+01:00'
blogger_id: tag:blogger.com,1999:blog-525051364647796957.post-755913605831581562
blogger_orig_url: http://john-hearn.blogspot.com/2017/11/notes-on-go-go-kit-for-java-programmer.html
---

We're using a lot of Java/Spring Boot based microservices where I work and the memory footprint is somewhat worrying from a production scalability perspective. <br /><br />The aim of this experiment is to take some first steps into Go to see if there is potential in exploring Go as an alternative to Java for some microservices. The aim here is take into account factors such as resource consumption, as compared to an identical service implemented in Java, and developer productivity but not not to take into account other factors like developer availability.<br /><br />One promising Go library to aid in the creation of microservices is <a href="https://gokit.io/" target="_blank">Go kit</a> . At first glance the simplest example seemed quite complicated. I decided to apply Go kit microservice design decisions to Java to be able to do a direct comparison. Lets take a look at the <a href="https://gokit.io/examples/stringsvc.html" target="_blank">simplest example</a> from the Go kit website. I'll copy the Go kit article's section headers, comments in the original webpage also apply here. We start with an interface and its implementation.<br /><br /><br /><h2>Your business logic</h2><b><br /></b><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;">type</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">StringService</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #dcdcaa;">sayHi</span><span style="color: #d4d4d4;">(context.Context, </span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;">) (</span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;">, </span><span style="color: #569cd6;">error</span><span style="color: #d4d4d4;">)</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #569cd6;">type</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">stringService</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">struct</span><span style="color: #d4d4d4;">{}</span></div><br /><div><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;"> (stringService) </span><span style="color: #dcdcaa;">sayHi</span><span style="color: #d4d4d4;">(_ context.Context, s </span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;">) (</span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;">, </span><span style="color: #569cd6;">error</span><span style="color: #d4d4d4;">) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">if</span><span style="color: #d4d4d4;"> s </span><span style="color: #d4d4d4;">==</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">""</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">""</span><span style="color: #d4d4d4;">, ErrEmpty</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">"Hello "</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> s </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">"!"</span><span style="color: #d4d4d4;">, </span><span style="color: #569cd6;">nil</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #569cd6;">var</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">ErrEmpty</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> errors.</span><span style="color: #dcdcaa;">New</span><span style="color: #d4d4d4;">(</span><span style="color: #ce9178;">"Empty string"</span><span style="color: #d4d4d4;">)</span></div></div><b></b><strike><b><br /></b></strike><br /><div>The Java version is very similar. Nothing really needs to be said here.</div><div><br /></div><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">StringService</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">sayHi</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">name</span><span style="color: #d4d4d4;">) </span><span style="color: #569cd6;">throws</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">IOException</span><span style="color: #d4d4d4;">;</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">class</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">StringServiceImpl</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">implements</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">StringService</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #569cd6;">public</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">sayHi</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">s</span><span style="color: #d4d4d4;">) </span><span style="color: #d4d4d4;">{</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">if</span><span style="color: #d4d4d4;"> (</span><span style="color: #ce9178;">""</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">equals</span><span style="color: #d4d4d4;">(s)) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">throw</span><span style="color: #d4d4d4;"> </span><span style="color: #c586c0;">new</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">InvalidArgumentException</span><span style="color: #d4d4d4;">(</span><span style="color: #ce9178;">"Empty string"</span><span style="color: #d4d4d4;">);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">"Hello "</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> s </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">"!"</span><span style="color: #d4d4d4;">;</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">}</span></div></div></div><div><h2></h2><h2>Requests and responses</h2><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;">type</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">sayHiRequest</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">struct</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;S </span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">`json:"s"`</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #569cd6;">type</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">sayHiResponse</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">struct</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;&nbsp; </span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">`json:"v"`</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;Err </span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">`json:"err,omitempty"`</span><span style="color: #d4d4d4;"> </span><span style="color: #608b4e;">// errors don't JSON-marshal, so we use a string</span></div><div><span style="color: #d4d4d4;">}</span></div></div></div><div><b></b><i></i><u></u><sub></sub><sup></sup><strike></strike><br /></div><div>Java version is almost identical:</div><div><br /></div><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;"><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">class</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">SayHiRequest</span><span style="color: #d4d4d4;"> {</span></span></div><span style="color: #d4d4d4;"><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">s</span><span style="color: #d4d4d4;">;</span></div><div><span style="color: #d4d4d4;">}</span></div><div><span style="color: #d4d4d4;"><br /></span></div><div><span style="color: #569cd6;">class</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">SayHiResponse</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">v</span><span style="color: #d4d4d4;">;</span></div></span><div><span style="color: #d4d4d4;"><span style="color: #d4d4d4;">}</span></span></div><i></i><u></u><sub></sub><sup></sup><strike></strike></div></div></div></div></div><div><br /></div><div>Notice that error handling in Java is done using exceptions, a concept that Go does not have, instead relying on error results in return tuples.<br /><br /></div><h2 id="endpoints">Endpoints</h2>Go kit provides much of its functionality through an abstraction called an <strong>endpoint</strong>. Now we must construct an instance of this abstraction:<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">makeSayHiEndpoint</span><span style="color: #d4d4d4;">(svc stringService) endpoint.Endpoint {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;">(ctx context.Context, request </span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;">{}) (</span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;">{}, </span><span style="color: #569cd6;">error</span><span style="color: #d4d4d4;">) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">req</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">:=</span><span style="color: #d4d4d4;"> request.(sayHiRequest)</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">v</span><span style="color: #d4d4d4;">, </span><span style="color: #9cdcfe;">err</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">:=</span><span style="color: #d4d4d4;"> svc.</span><span style="color: #dcdcaa;">sayHi</span><span style="color: #d4d4d4;">(ctx, req.S)</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">if</span><span style="color: #d4d4d4;"> err </span><span style="color: #d4d4d4;">!=</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">nil</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> sayHiResponse{v, err.</span><span style="color: #dcdcaa;">Error</span><span style="color: #d4d4d4;">()}, </span><span style="color: #569cd6;">nil</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> sayHiResponse{v, </span><span style="color: #ce9178;">""</span><span style="color: #d4d4d4;">}, </span><span style="color: #569cd6;">nil</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">}</span></div></div><br />We can emulate the Endpoint abstraction with a functional interface in Java.<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #4ec9b0;">@FunctionalInterface</span></div><div><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Endpoint</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">Object</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">Object</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">request</span><span style="color: #d4d4d4;">) </span><span style="color: #569cd6;">throws</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">IOException</span><span style="color: #d4d4d4;">;</span></div><div><span style="color: #d4d4d4;">}</span></div></div><b><br /></b>The use of IOException here is to avoid the need to translate checked exceptions to unchecked ones in the handler code. However, the use of unchecked exceptions would facilitate the use of the Java standard functional library and eliminate the need to specific functional interfaces. We create an instance of the lambda, copying the Go implementation very closely. Error handling is done by exceptions which simplifies the code.<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Endpoint</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">makeSayHiEndpoint</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">StringService</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">svc</span><span style="color: #d4d4d4;">) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> (req) </span><span style="color: #569cd6;">-&gt;</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">SayHiRequest</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">request</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> (</span><span style="color: #4ec9b0;">SayHiRequest</span><span style="color: #d4d4d4;">)req;</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">SayHiResponse</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">response</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #c586c0;">new</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">SayHiResponse</span><span style="color: #d4d4d4;">();</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">response</span><span style="color: #d4d4d4;">.</span><span style="color: #9cdcfe;">v</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">svc</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">sayHi</span><span style="color: #d4d4d4;">(</span><span style="color: #9cdcfe;">request</span><span style="color: #d4d4d4;">.</span><span style="color: #9cdcfe;">s</span><span style="color: #d4d4d4;">);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> response;</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;};</span></div><div><span style="color: #d4d4d4;">}</span></div></div><b><br /></b><br /><h2>Transports</h2>In the example the service is published as JSON over HTTP.<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;"></span><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;"><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">main</span><span style="color: #d4d4d4;">() {</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">svc</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">:=</span><span style="color: #d4d4d4;"> stringService{}</span></span></div><span style="color: #569cd6;"><br /></span><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">sayHiHandler</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">:=</span><span style="color: #d4d4d4;"> httptransport.</span><span style="color: #dcdcaa;">NewServer</span><span style="color: #d4d4d4;">(</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #dcdcaa;">makeSayHiEndpoint</span><span style="color: #d4d4d4;">(svc),</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;decodeSayHiRequest,</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encodeResponse,</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;)</span></span></div><span style="color: #569cd6;"><br /></span><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;http.</span><span style="color: #dcdcaa;">Handle</span><span style="color: #d4d4d4;">(</span><span style="color: #ce9178;">"/sayHi"</span><span style="color: #d4d4d4;">, sayHiHandler)</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;log.</span><span style="color: #dcdcaa;">Fatal</span><span style="color: #d4d4d4;">(http.</span><span style="color: #dcdcaa;">ListenAndServe</span><span style="color: #d4d4d4;">(</span><span style="color: #ce9178;">":8080"</span><span style="color: #d4d4d4;">, </span><span style="color: #569cd6;">nil</span><span style="color: #d4d4d4;">))</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">}</span></span></div></div><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">decodeSayHiRequest</span><span style="color: #d4d4d4;">(_ context.Context, r </span><span style="color: #d4d4d4;">*</span><span style="color: #d4d4d4;">http.Request) (</span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;">{}, </span><span style="color: #569cd6;">error</span><span style="color: #d4d4d4;">) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #569cd6;">var</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">request</span><span style="color: #d4d4d4;"> sayHiRequest</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">if</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">err</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">:=</span><span style="color: #d4d4d4;"> json.</span><span style="color: #dcdcaa;">NewDecoder</span><span style="color: #d4d4d4;">(r.Body).</span><span style="color: #dcdcaa;">Decode</span><span style="color: #d4d4d4;">(</span><span style="color: #d4d4d4;">&amp;</span><span style="color: #d4d4d4;">request); err </span><span style="color: #d4d4d4;">!=</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">nil</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">nil</span><span style="color: #d4d4d4;">, err</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> request, </span><span style="color: #569cd6;">nil</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">encodeResponse</span><span style="color: #d4d4d4;">(_ context.Context, w http.ResponseWriter, response </span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;">{}) </span><span style="color: #569cd6;">error</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> json.</span><span style="color: #dcdcaa;">NewEncoder</span><span style="color: #d4d4d4;">(w).</span><span style="color: #dcdcaa;">Encode</span><span style="color: #d4d4d4;">(response)</span></div><div><span style="color: #d4d4d4;">}</span></div></div><b></b><i></i><u></u><sub></sub><sup></sup><strike></strike><br /><b></b><i></i><u></u><sub></sub><sup></sup><strike></strike>To convert this to Java we're going to use Oracle's built-in <span style="color: #4ec9b0;"><span style="background-color: #444444; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">HttpServer</span></span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;"></span>classes. Since Java does not have a built-in Json serialisation library we'll marshal the JSON with the Gson to provide a realistic comparison.<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;"></span><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;"><span style="color: #569cd6;">public</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">void</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">main</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;">[] </span><span style="color: #9cdcfe;">args</span><span style="color: #d4d4d4;">) </span><span style="color: #569cd6;">throws</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Exception</span><span style="color: #d4d4d4;"> {</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #608b4e;">// ListenAndServe starts an HTTP server on the given port. </span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">HttpServer</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">server</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">HttpServer</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">create</span><span style="color: #d4d4d4;">(</span><span style="color: #c586c0;">new</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">InetSocketAddress</span><span style="color: #d4d4d4;">(</span><span style="color: #b5cea8;">8080</span><span style="color: #d4d4d4;">), </span><span style="color: #b5cea8;">0</span><span style="color: #d4d4d4;">);</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #608b4e;">// Attach the handler function to the context</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">StringService</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">svc</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #c586c0;">new</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">StringServiceImpl</span><span style="color: #d4d4d4;">();</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">HttpHandler</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">sayHiHandler</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">HttpTransport</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">newServer</span><span style="color: #d4d4d4;">(</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #dcdcaa;">makeSayHiEndpoint</span><span style="color: #d4d4d4;">(svc),</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simplest_gokit_service</span><span style="color: #c586c0;">::</span><span style="color: #d4d4d4;">decodeSayHiRequest,</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simplest_gokit_service</span><span style="color: #c586c0;">::</span><span style="color: #d4d4d4;">encodeResponse</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;);</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">server</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">createContext</span><span style="color: #d4d4d4;">(</span><span style="color: #ce9178;">"/"</span><span style="color: #d4d4d4;">, sayHiHandler);</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">server</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">start</span><span style="color: #d4d4d4;">();</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">}</span></span></div></div><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">SayHiRequest</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">decodeSayHiRequest</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">HttpExchange</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">t</span><span style="color: #d4d4d4;">) </span><span style="color: #569cd6;">throws</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">IOException</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">try</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">InputStreamReader</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">r</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #c586c0;">new</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">InputStreamReader</span><span style="color: #d4d4d4;">(</span><span style="color: #9cdcfe;">t</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">getRequestBody</span><span style="color: #d4d4d4;">())) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #c586c0;">new</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">Gson</span><span style="color: #d4d4d4;">().</span><span style="color: #dcdcaa;">fromJson</span><span style="color: #d4d4d4;">(r, </span><span style="color: #9cdcfe;">SayHiRequest</span><span style="color: #d4d4d4;">.</span><span style="color: #9cdcfe;">class</span><span style="color: #d4d4d4;">);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">}</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">void</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">encodeResponse</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">HttpExchange</span><span style="color: #d4d4d4;"> t, </span><span style="color: #4ec9b0;">Object</span><span style="color: #d4d4d4;"> response) throws </span><span style="color: #4ec9b0;">IOException</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">try</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">OutputStream</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">w</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">t</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">getResponseBody</span><span style="color: #d4d4d4;">()) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">byte</span><span style="color: #d4d4d4;">[] </span><span style="color: #9cdcfe;">bytes</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #c586c0;">new</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">Gson</span><span style="color: #d4d4d4;">().</span><span style="color: #dcdcaa;">toJson</span><span style="color: #d4d4d4;">(response).</span><span style="color: #dcdcaa;">getBytes</span><span style="color: #d4d4d4;">();</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">t</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">sendResponseHeaders</span><span style="color: #d4d4d4;">(</span><span style="color: #b5cea8;">200</span><span style="color: #d4d4d4;">, </span><span style="color: #9cdcfe;">bytes</span><span style="color: #d4d4d4;">.</span><span style="color: #9cdcfe;">length</span><span style="color: #d4d4d4;">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">w</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">write</span><span style="color: #d4d4d4;">(bytes);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">}</span></div></div><b><br /></b>Again the code is very similar. To emulate the Go kit functionality we add functional interfaces and a method which binds them together to provide the decoder-endpoint-encoder chain. Note that this emulates the entire Go kit library up to this point.<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #4ec9b0;">@FunctionalInterface</span></div><div><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Endpoint</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">Object</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">Object</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">request</span><span style="color: #d4d4d4;">) </span><span style="color: #569cd6;">throws</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">IOException</span><span style="color: #d4d4d4;">;</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #4ec9b0;">@FunctionalInterface</span></div><div><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Decoder</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">Object</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">HttpExchange</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">t</span><span style="color: #d4d4d4;">) </span><span style="color: #569cd6;">throws</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">IOException</span><span style="color: #d4d4d4;">;</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #4ec9b0;">@FunctionalInterface</span></div><div><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Encoder</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">void</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">HttpExchange</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">t</span><span style="color: #d4d4d4;">, </span><span style="color: #4ec9b0;">Object</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">response</span><span style="color: #d4d4d4;">) </span><span style="color: #569cd6;">throws</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">IOException</span><span style="color: #d4d4d4;">;</span></div><div><span style="color: #d4d4d4;">}</span></div><br /><div><span style="color: #569cd6;">class</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">HttpTransport</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">HttpHandler</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">newServer</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">Endpoint</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">endpoint</span><span style="color: #d4d4d4;">, </span><span style="color: #4ec9b0;">Decoder</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">decoder</span><span style="color: #d4d4d4;">, </span><span style="color: #4ec9b0;">Encoder</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">encoder</span><span style="color: #d4d4d4;">) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> (t) </span><span style="color: #569cd6;">-&gt;</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">encoder</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(t, </span><span style="color: #9cdcfe;">endpoint</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(</span><span style="color: #9cdcfe;">decoder</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(t)));</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">}</span></div><div><span style="color: #d4d4d4;"></span></div></div><b><br /></b>Run the Go version:<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&gt;</span><span style="color: #d4d4d4;"> go run </span><span style="color: #9cdcfe;">simplest_gokit_service</span><span style="color: #d4d4d4;">.</span><span style="color: #9cdcfe;">go</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">&amp;</span></div><div><span style="color: #d4d4d4;">&gt;</span><span style="color: #d4d4d4;">&nbsp;curl </span><span style="color: #d4d4d4;">-</span><span style="color: #d4d4d4;">d</span><span style="color: #ce9178;">'{"s":"Donald"}'</span><span style="color: #d4d4d4;"> localhost</span><span style="color: #c586c0;">:</span><span style="color: #b5cea8;">8080</span><span style="color: #d4d4d4;">/</span><span style="color: #d4d4d4;">sayHi</span></div><div><span style="color: #d4d4d4;">{</span><span style="color: #ce9178;">"v"</span><span style="color: #c586c0;">:</span><span style="color: #ce9178;">"Hello Donald!"</span><span style="color: #d4d4d4;">}</span></div></div><div><b></b><i></i><u></u><sub></sub><sup></sup><strike><br /></strike></div><div>Run the Java version:<br /><br /></div><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&gt;</span><span style="color: #d4d4d4;"> java </span><span style="color: #d4d4d4;">-</span><span style="color: #d4d4d4;">cp .</span><span style="color: #c586c0;">:</span><span style="color: #d4d4d4;">gson</span><span style="color: #d4d4d4;">-</span><span style="color: #b5cea8;">2.8</span><span style="color: #d4d4d4;">.</span><span style="color: #f44747;">2</span><span style="color: #d4d4d4;">.</span><span style="color: #9cdcfe;">jar</span><span style="color: #d4d4d4;"> simplest_gokit_service </span><span style="color: #d4d4d4;">&amp;</span></div><div><span style="color: #d4d4d4;">[</span><span style="color: #b5cea8;">2</span><span style="color: #d4d4d4;">] </span><span style="color: #b5cea8;">1592</span></div><div><span style="color: #d4d4d4;">&gt;</span><span style="color: #d4d4d4;"> curl </span><span style="color: #d4d4d4;">-</span><span style="color: #d4d4d4;">d</span><span style="color: #ce9178;">'{"s":"Donald"}'</span><span style="color: #d4d4d4;"> localhost</span><span style="color: #c586c0;">:</span><span style="color: #b5cea8;">8080</span><span style="color: #d4d4d4;">/</span><span style="color: #d4d4d4;">sayHi</span></div><div><span style="color: #d4d4d4;">{</span><span style="color: #ce9178;">"v"</span><span style="color: #c586c0;">:</span><span style="color: #ce9178;">"Hello Donald!"</span><span style="color: #d4d4d4;">}</span></div></div></div><br /><h1 id="middlewares">Middlewares</h1>No service can be considered production-ready without thorough logging and instrumentation.<br /><br /><h2 id="transport-logging">Transport logging</h2><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas,&quot;Courier New&quot;,monospace; font-size: 14px; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;"></span><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #569cd6;"><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">loggingMiddleware</span><span style="color: #d4d4d4;">(name </span><span style="color: #569cd6;">string</span><span style="color: #d4d4d4;">, w io.Writer) endpoint.Middleware {</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;">(next endpoint.Endpoint) endpoint.Endpoint {</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #569cd6;">func</span><span style="color: #d4d4d4;">(ctx context.Context, request </span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;">{}) (</span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;">{}, </span><span style="color: #569cd6;">error</span><span style="color: #d4d4d4;">) {</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io.</span><span style="color: #dcdcaa;">WriteString</span><span style="color: #d4d4d4;">(w, </span><span style="color: #ce9178;">"calling "<span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> name </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">" </span>endpoint\n"</span><span style="color: #d4d4d4;">)</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">defer</span><span style="color: #d4d4d4;"> io.</span><span style="color: #dcdcaa;">WriteString</span><span style="color: #d4d4d4;">(w, </span><span style="color: #ce9178;">"called "</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> name </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">" endpoint\n"</span><span style="color: #d4d4d4;">)</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">next</span><span style="color: #d4d4d4;">(ctx, request)</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></div><div><span style="color: #569cd6;"><span style="color: #d4d4d4;">}</span></span></div></div><span style="color: #569cd6;"></span><b></b><i></i><u></u><sub></sub><sup></sup><strike><b></b></strike></div></div><div><br />Here we see the "defer" keyword in action. In Java we use finally:&nbsp;</div><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #569cd6;">static</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Middleware</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">loggingMiddleware</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">String</span><span style="color: #d4d4d4;"> name, </span><span style="color: #4ec9b0;">PrintStream</span><span style="color: #d4d4d4;"> writer) {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> (next) </span><span style="color: #569cd6;">-&gt;</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> (request) </span><span style="color: #569cd6;">-&gt;</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">try</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">writer</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">println</span><span style="color: #d4d4d4;">(</span><span style="color: #ce9178;">"calling "</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> name </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">"endpoint"</span><span style="color: #d4d4d4;">);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">return</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(request);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #c586c0;">finally</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">writer</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">println</span><span style="color: #d4d4d4;">(</span><span style="color: #ce9178;">"called "</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> name </span><span style="color: #d4d4d4;">+</span><span style="color: #d4d4d4;"> </span><span style="color: #ce9178;">"endpoint"</span><span style="color: #d4d4d4;">);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div></div><div><br /></div><div>Once again we create a functional interface to emulate the Go Middleware type:</div><div><br /></div><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">@FunctionalInterface</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #569cd6;">interface</span><span style="color: #d4d4d4;"> </span><span style="color: #4ec9b0;">Middleware</span><span style="color: #d4d4d4;"> {</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">Endpoint</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(</span><span style="color: #4ec9b0;">Endpoint</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">next</span><span style="color: #d4d4d4;">);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div></div><b></b></div><div><b></b><i></i><u></u><sub></sub><sup></sup><strike><br /></strike></div><div>Wiring it up is virtually the same in both languages:</div><div><br /></div><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #569cd6;">var</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">sayHi</span><span style="color: #d4d4d4;"> endpoint.Endpoint</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">sayHi</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">makeSayHiEndpoint</span><span style="color: #d4d4d4;">(svc);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">sayHi</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">loggingMiddleware</span><span style="color: #d4d4d4;">("sayHi", <span style="color: #d4d4d4;">os.Stderr</span></span><span style="color: #d4d4d4;">)(sayHi)&nbsp;&nbsp;&nbsp;</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #9cdcfe;">sayHiHandler</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">:=</span><span style="color: #d4d4d4;"> httptransport.</span><span style="color: #dcdcaa;">NewServer</span><span style="color: #d4d4d4;">(</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sayHi,</span></div><div><span style="color: #d4d4d4;">        ...</span></div><div><span style="color: #d4d4d4;"></span></div></div><b></b></div><br />And in Java:<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">Endpoint</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">sayHi</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">makeSayHiEndpoint</span><span style="color: #d4d4d4;">(svc);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;sayHi </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #dcdcaa;">loggingMiddleware</span><span style="color: #d4d4d4;">("sayHi", </span><span style="color: #9cdcfe;">System</span><span style="color: #d4d4d4;">.</span><span style="color: #9cdcfe;">err</span><span style="color: #d4d4d4;">).</span><span style="color: #dcdcaa;">func</span><span style="color: #d4d4d4;">(sayHi);</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #4ec9b0;">HttpHandler</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">sayHiHandler</span><span style="color: #d4d4d4;"> </span><span style="color: #d4d4d4;">=</span><span style="color: #d4d4d4;"> </span><span style="color: #9cdcfe;">HttpTransport</span><span style="color: #d4d4d4;">.</span><span style="color: #dcdcaa;">newServer</span><span style="color: #d4d4d4;">(</span></div><div><span style="color: #d4d4d4;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sayHi,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<b></b></div><div><span style="color: #d4d4d4;"></span></div></div><b></b><br /><div><b><br /></b></div>Run the Go version:<br /><br /><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&gt; </span>go run simplest_gokit_service.go &amp;<span style="color: #d4d4d4;"></span></div><div><span style="color: #d4d4d4;">&gt;</span><span style="color: #d4d4d4;">&nbsp;curl </span><span style="color: #d4d4d4;">-</span><span style="color: #d4d4d4;">d</span><span style="color: #ce9178;">'{"s":"Donald"}'</span><span style="color: #d4d4d4;"> localhost</span><span style="color: #c586c0;">:</span><span style="color: #b5cea8;">8080</span><span style="color: #d4d4d4;">/</span><span style="color: #d4d4d4;">sayHi</span></div><div><span style="color: #d4d4d4;"><div><span style="color: #d4d4d4;"><span style="color: #d4d4d4;">calling sayHi endpoint</span></span><span style="color: #d4d4d4;"><br /></span></div><span style="color: #d4d4d4;"><div><span style="color: #d4d4d4;">called sayHi endpoint</span></div></span><br /><div><span style="color: #d4d4d4;"><span style="color: #d4d4d4;">{</span><span style="color: #ce9178;">"v"</span><span style="color: #c586c0;">:</span><span style="color: #ce9178;">"Hello Donald!"</span><span style="color: #d4d4d4;">}</span></span></div></span></div></div><div><b></b><i></i><u></u><sub></sub><sup></sup><strike><b></b><i></i><u></u><sub></sub><sup></sup><br /></strike></div><div>Run the Java version:<br /><br /></div><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><div><span style="color: #d4d4d4;">&gt; </span>java -cp .:gson-2.8.2.jar simplest_gokit_service <span style="color: #d4d4d4;"></span><span style="color: #d4d4d4;">&amp;</span></div><div><span style="color: #d4d4d4;">&gt;</span><span style="color: #d4d4d4;"> curl </span><span style="color: #d4d4d4;">-</span><span style="color: #d4d4d4;">d</span><span style="color: #ce9178;">'{"s":"Donald"}'</span><span style="color: #d4d4d4;"> localhost</span><span style="color: #c586c0;">:</span><span style="color: #b5cea8;">8080</span><span style="color: #d4d4d4;">/</span><span style="color: #d4d4d4;">sayHi</span></div><div><div style="background-color: #1e1e1e; color: #d4d4d4; font-family: Consolas, 'Courier New', monospace; font-size: 14px; font-weight: normal; line-height: 19px; white-space: pre;"><span style="color: #d4d4d4;"></span><br /><div><span style="color: #d4d4d4;"><span style="color: #d4d4d4;">calling sayHi endpoint</span></span><span style="color: #d4d4d4;"></span></div><span style="color: #d4d4d4;"><div><span style="color: #d4d4d4;">called sayHi endpoint</span></div></span><br /><div><span style="color: #d4d4d4;"><span style="color: #d4d4d4;">{</span><span style="color: #ce9178;">"v"</span><span style="color: #c586c0;">:</span><span style="color: #ce9178;">"Hello Donald!"</span><span style="color: #d4d4d4;">}</span></span></div></div></div></div></div><br />Benchmarking response times would be pointless in this simple scenario. Taking a look the the memory footprint however, without any kind of runtime optimisation, the Java implementation is close to 23Mb while the Go binary runs in a little over 1Mb. This difference by itself would be worth investigating in a system with many microservice instances.<br /><br /><h2>Conclusions</h2>The Go kit abstractions lend themselves well to composition. It has been possible to recreate the same experience in Java with almost a line for line translation using Java's lambda syntax. The abstractions are quite low level but I can't help feeling that it takes a step too far in terms of developer productivity compared to something like Spring REST Controllers.<br /><br />On the other hand memory use is many times smaller for the Go binary, as would be expected. I would also expect Java libraries like Spring would bloat the Java version even more.