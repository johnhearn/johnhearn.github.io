<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Notes on the Art of TDD - Uno (Part 1)</title>

  
  
  <meta name="keywords" content="ood series, tdd"/>
  
  
  <meta property="og:title" content="Notes on the Art of TDD - Uno (Part 1)">
  <meta property="og:type" content="note">
  <meta property="og:url" content="https://johnhearn.github.io//articles/notes-on-art-of-tdd-uno-part-1/">
  <meta property="og:image" content="https://johnhearn.github.io/">
  <meta property="og:description" content="Personal site for blogging and about science, software and such">
  <meta property="og:site_name" content="John Hearn">
  
  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@johnhearnbcn">
  <meta name="twitter:creator" content="@johnhearnbcn">
  <meta name="twitter:title"   content="Notes on the Art of TDD - Uno (Part 1)">

  
  <meta name="twitter:description" content="Personal site for blogging and about science, software and such">
  

  
  <!-- end of Twitter cards -->

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
  
  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
      <script type="text/x-mathjax-config"> 
        MathJax.Ajax.config.path["Contrib"]="https://cdn.mathjax.org/mathjax/contrib"; 
        MathJax.Hub.Register.StartupHook("TeX Jax Ready",function (){MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{cancel: ["Extension","cancel"], bcancel: ["Extension","cancel"], xcancel: ["Extension","cancel"], cancelto: ["Extension","cancel"]});}); 
        MathJax.Hub.Config({tex2jax:{inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true}, TeX:{equationNumbers:{autoNumber: "AMS"}, extensions: ["[Contrib]/physics/physics.js","[Contrib]/siunitx/siunitx.js"]}});
      </script>
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

  <link rel="stylesheet" type="text/css" href="/css/tufte.css">
  <!-- <link rel="stylesheet" type="text/css" href="/css/print.css" media="print"> -->

  <link rel="canonical" href="https://johnhearn.github.io//articles/notes-on-art-of-tdd-uno-part-1">

  <link rel="alternate" type="application/rss+xml" title="John Hearn" href="https://johnhearn.github.io//feed.xml" />
</head>

  <body>
    <!--- Header and nav template site-wide -->
<header>
  <nav class="group">
	  <a href="/">BLOG</a>
	  <a href="/notes.html">NOTES</a>
	  <a href="/about">ABOUT</a>
	</nav>
</header>
    <article class="group">
      <h1>Notes on the Art of TDD - Uno (Part 1)</h1>
<div class="subtitle">May 15, 2017</div>
<div class="smaller">18 minutes.</div>

<p>Playing Uno with my daughter the other day I was wondering about the best strategies. I thought I’d build a Uno game not only to answer that question but also (and mainly) to improve my OO and TDD skills. These notes were taken during the process of creating the game model using TDD and contain not only good practice but also the mistakes. Some of the mistakes have been labelled as such in the notes. The exercise has taught me a lot. The post became quite long so it’s split into various parts. I’ll try and summarise the lessons learn in the final installment. All the code in this blog is available on GitHub <a href="https://github.com/johnhearn/uno">here</a>. Anyway this is how I started….</p>

<p> As always in TDD we start with a test definition. What about this as a starting point?</p>

<blockquote>
  <p>Start a game with 4 players. Every player is dealt a hand of seven cards from the pack and the top card in the pack is turned over. Each player in turn decides whether to play a card or to pick up the top card. To play a card they have to match the top card either by the number, color, or the symbol/Action. You can also play a Wild card……. The winner is first player to have no cards. x</p>
</blockquote>

<p>This is quickly becoming the entire game. This isn’t a test step but rather the final destination, perhaps an acceptance test. It’s not giving us a readily testable outcome and it’s getting bogged down in detail. Let’s make it simpler.</p>

<blockquote>
  <p>Player plays a card. x</p>
</blockquote>

<p>This is certainly testable but it’s not outside-in, it’s a step in a test rather than a self-contained test from a user’s perspective. This might be closer to a unit test iteration. Compare with this:</p>

<blockquote>
  <p>Start a game with 2 players. Every player is dealt a hand of seven cards. Each player in turn plays a card. The winner is first player to have no cards.</p>
</blockquote>

<p>This is obviously not a very fun game since the winner is always the first player. There is no top card or matching algorithm. Nonetheless it should flesh out our model quite a bit, and most importantly, it gives us a useful outside-in acceptance test, i.e. the winner has no cards, which will still be valid in future iterations.</p>

<p><label for="improved-acceptance-test" class="margin-toggle"> ⊕</label><input type="checkbox" id="improved-acceptance-test" class="margin-toggle" /><span class="marginnote">I later realised that a better acceptance test would also include something like print the name of the winner. The test above doesn’t involve any interface to a user at all making the game model fairly useless. </span></p>

<p>What does the above test look like using JUnit?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGame</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">UnoGame</span> <span class="n">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UnoGame</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
  <span class="n">game</span><span class="o">.</span><span class="na">deal</span><span class="o">();</span>
  <span class="n">game</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">game</span><span class="o">.</span><span class="na">winner</span><span class="o">().</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>How’s that? We create a game with 2 players, exactly as we stated. We deal the cards then play the game, checking that the winner has no cards. Do we know that deal() and play() need to be separate methods on the game class? Would it make sense for play() to be called and not deal()? No, let’s get rid of it. Intuition tells us that we may come back to it later but not yet. Patience is a part of TDD. What would happen if we called winner() without playing a game? Probably nothing good so let’s try simplifying.</p>

<p><label for="game-vs-round" class="margin-toggle"> ⊕</label><input type="checkbox" id="game-vs-round" class="margin-toggle" /><span class="marginnote">Note: a Uno game actually ends when a player has scored 500 or more points. What we’re dealing with here is a <em>single round</em> in a game. That’s something I realised later and was able to resolve by renaming it to <code class="language-plaintext highlighter-rouge">Round</code>. </span></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGame</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">UnoGame</span> <span class="n">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UnoGame</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
  <span class="nc">Player</span> <span class="n">winner</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">winner</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>It doesn’t get much simpler than that. We’ve reduced coupling and can now guarantee that a winner won’t be available until after the game has been played. We can implement it in about 30 seconds (the IDE does most of the typing for us). But wait, that was too easy. <code class="language-plaintext highlighter-rouge">Player.numCards()</code> can always return 0. What about dealing and playing cards? What about actual cards? There’s something else. The test says “…winner is <strong>first</strong> player to have no cards”. We haven’t tested that at all. Extend the test.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGame</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">UnoGame</span> <span class="n">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UnoGame</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
  <span class="nc">Player</span> <span class="n">winner</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
  <span class="k">for</span><span class="o">(</span><span class="nc">Player</span> <span class="n">player</span> <span class="o">:</span> <span class="n">game</span><span class="o">.</span><span class="na">players</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">player</span> <span class="o">==</span> <span class="n">winner</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">player</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">player</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isNotEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// We add this to test the whole requirement</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Once compilation errors have been corrected we have the error:</p>

<blockquote>
  <p>Expected 0 to be not equal to 0</p>
</blockquote>

<p>That’s because we’ve cheated and given all players 0 cards. Now we have to implement some actual logic to get things moving. We write some code to deal some cards. This forces us to flesh out the Game and Player classes. Run the test…</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Player</span> <span class="nf">play</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">deal</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">deal</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Player</span> <span class="n">player</span> <span class="o">:</span> <span class="n">players</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">player</span><span class="o">.</span><span class="na">giveCard</span><span class="o">(</span><span class="k">new</span> <span class="nc">Card</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Result:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; org.junit.ComparisonFailure: expected:&lt;[0]&gt; but was:&lt;[7]&gt;
</code></pre></div></div>

<p>Now we have the opposite error. The players have cards but they’re not being played so nobody wins. Write some more code.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Player</span> <span class="nf">play</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">deal</span><span class="o">();</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Player</span> <span class="n">player</span> <span class="o">:</span> <span class="n">players</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">player</span><span class="o">.</span><span class="na">playCard</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">player</span><span class="o">.</span><span class="na">numCards</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">player</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">deal</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Player</span> <span class="n">player</span> <span class="o">:</span> <span class="n">players</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">player</span><span class="o">.</span><span class="na">giveCard</span><span class="o">(</span><span class="k">new</span> <span class="nc">Card</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>That goes green so let’s take stock. We have covered the first test case but some comments should be made. In order to test the game we have exposed <code class="language-plaintext highlighter-rouge">Player#numCards()</code> and <code class="language-plaintext highlighter-rouge">Game#players()</code>. The <code class="language-plaintext highlighter-rouge">players()</code> method smells of information leak but let’s live with it for now. We’re also leaving aside error handling for a moment (we have a risky while(true) loop in there!)</p>

<p><label for="commit" class="margin-toggle"> ⊕</label><input type="checkbox" id="commit" class="margin-toggle" /><span class="marginnote">Note to self: should have committed to version control here. </span></p>

<p>Let’s extend the test some more.</p>

<blockquote>
  <p>Every player is dealt a hand of seven cards <strong><em>from the pack</em></strong>….</p>
</blockquote>

<p>Extend our unit test to include a pack abstraction.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGame</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">UnoGame</span> <span class="n">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UnoGame</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">game</span><span class="o">.</span><span class="na">getPack</span><span class="o">().</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
  <span class="nc">Player</span> <span class="n">winner</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">game</span><span class="o">.</span><span class="na">getPack</span><span class="o">().</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">6</span><span class="o">);</span>
  <span class="k">for</span><span class="o">(</span><span class="nc">Player</span> <span class="n">player</span> <span class="o">:</span> <span class="n">game</span><span class="o">.</span><span class="na">players</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">player</span> <span class="o">==</span> <span class="n">winner</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">player</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">player</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isNotEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">game</span><span class="o">.</span><span class="na">getPack</span><span class="o">().</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">6</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We generate a <code class="language-plaintext highlighter-rouge">Pack</code> class and give it a <code class="language-plaintext highlighter-rouge">numCards()</code> method to make the test compile. It turns out that <code class="language-plaintext highlighter-rouge">numCards()</code> is also needed by the <code class="language-plaintext highlighter-rouge">Player</code> class so take note of that. The test fails, obviously. Let’s do some coding to make it work. In doing so it becomes necessary for the <code class="language-plaintext highlighter-rouge">Pack</code> class to have a <code class="language-plaintext highlighter-rouge">takeCard()</code> method. Makes sense. From now on, within the game all cards should come from the pack (obviously!).</p>

<p><label for="commit" class="margin-toggle"> ⊕</label><input type="checkbox" id="commit" class="margin-toggle" /><span class="marginnote">Having discovered that <code class="language-plaintext highlighter-rouge">Pack</code> needed a <code class="language-plaintext highlighter-rouge">takeCard()</code> method, I didn’t consider whether that method should have been tested with it’s own test cases. This is something that should be done whenever generating new methods beyond those mentioned in the latest test case. </span></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Pack</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Card</span><span class="o">&gt;</span> <span class="n">cards</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;&gt;();</span>

 <span class="kd">public</span> <span class="nf">Pack</span><span class="o">(</span><span class="kt">int</span> <span class="n">numCards</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">numCards</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="n">cards</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Card</span><span class="o">());</span>
   <span class="o">}</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kt">int</span> <span class="nf">numCards</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">cards</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="nc">Card</span> <span class="nf">takeCard</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">cards</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Again, this looks similar to the Player class but lets not worry about that for a moment. Run the tests. Hurray they are green!! Now we have green tests we can set about refactoring <code class="language-plaintext highlighter-rouge">Player</code> and <code class="language-plaintext highlighter-rouge">Pack</code> to share common code. For example by extending the abstraction of <code class="language-plaintext highlighter-rouge">Pack</code> to <code class="language-plaintext highlighter-rouge">CardHolder</code> and making it a super-class of both. The IDE does most of this for us. <code class="language-plaintext highlighter-rouge">Player</code> is now:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Player</span> <span class="kd">extends</span> <span class="nc">CardHolder</span> <span class="o">{</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">giveCard</span><span class="o">(</span><span class="nc">Card</span> <span class="n">card</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">cards</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">card</span><span class="o">);</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">playCard</span><span class="o">()</span> <span class="o">{</span>
   <span class="n">cards</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Simple and clean and the tests still pass. Of course as a game it is still utterly useless. With TDD that’s something we have to live with. Normally we’d plough on and implement the game logic all in one go but TDD forces us to approach the problem bit by bit. Patience. This gets even harder with different types of algorithm but I’ll leave that for another post.</p>

<p>Taking stock we have a game with players, a pack and a cards. The cards are dealt and played in turn. Now we don’t want just any old pack of cards we want a Uno pack. This is what it eventually should look like.</p>

<p><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/UNO_cards_deck.svg/220px-UNO_cards_deck.svg.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/UNO_cards_deck.svg/220px-UNO_cards_deck.svg.png" alt="" /></a></p>

<p>For now we’ll start with the numbered cards. Lets write another test for Pack.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// How many cards? 1-&gt;9 * 4 colours</span>
  <span class="nc">Pack</span> <span class="n">pack</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Pack</span><span class="o">();</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">pack</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">36</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In doing so we started fleshing out the <code class="language-plaintext highlighter-rouge">Card</code> class as well.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Card</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Colour</span> <span class="o">{</span>
   <span class="no">GREEN</span><span class="o">,</span>
   <span class="no">YELLOW</span><span class="o">,</span>
   <span class="no">RED</span><span class="o">,</span>
   <span class="no">BLUE</span>
 <span class="o">}</span>

 <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>
 <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Colour</span> <span class="n">colour</span><span class="o">;</span>

 <span class="kd">public</span> <span class="nf">Card</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">,</span> <span class="nc">Colour</span> <span class="n">colour</span><span class="o">)</span> <span class="o">{</span>
   <span class="kd">super</span><span class="o">();</span>
   <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">;</span>
   <span class="k">this</span><span class="o">.</span><span class="na">colour</span> <span class="o">=</span> <span class="n">colour</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><label for="numbered-card" class="margin-toggle"> ⊕</label><input type="checkbox" id="numbered-card" class="margin-toggle" /><span class="marginnote">I realised much later that I should have named the class <code class="language-plaintext highlighter-rouge">NumberedCard</code> at this point. Calling it <code class="language-plaintext highlighter-rouge">Card</code> is too generic and makes refactoring a common base class more tricky later on. TDD is hard. Good OO is hard. They are skills that need to be learned through practice. </span></p>

<p>So we have a game with players and something resembling the beginnings of a Uno pack. Can we add some Uno game play? Not until we have a discard pile. Let’s do that next.</p>

<blockquote>
  <p>Each player in turn plays a card… <strong>onto the discard pile</strong>. </p>
</blockquote>

<p>At the end of a game the pile should have 1 + 7 + 6 cards but we can go further by adding a check to ensure that the total count of cards (players, pack and pile, hasn’t changed).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGame</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">UnoGame</span> <span class="n">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UnoGame</span><span class="o">(</span><span class="no">PLAYERS</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">cards</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="na">getPack</span><span class="o">().</span><span class="na">numCards</span><span class="o">();</span>
  <span class="nc">Player</span> <span class="n">winner</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>

  <span class="k">for</span><span class="o">(</span><span class="nc">Player</span> <span class="n">player</span> <span class="o">:</span> <span class="n">game</span><span class="o">.</span><span class="na">players</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">player</span> <span class="o">==</span> <span class="n">winner</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">player</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">player</span><span class="o">.</span><span class="na">numCards</span><span class="o">()).</span><span class="na">isNotEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">countTotalCards</span><span class="o">(</span><span class="n">game</span><span class="o">)).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">cards</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">countTotalCards()</code> helper method just adds up all the cards in the pile, the pack and each player. The test is independent of the number of players so I extracted that into a constant to make the code more readable.</p>

<p>Run it and it fails! I’d forgotten to add the player’s cards to the pile. That drives out more domain functionality and everything passes again. We have now actually covered the first test case (and a bit more) and we should commit to version control (perhaps we should have done that before?).</p>

<p>We’re getting close to being able to add some real Uno game play. So we add a new test.</p>

<blockquote>
  <p>Given the top card on the pile, the player plays a card if they match the top card either by the number or color, otherwise they pick up a card from the pack. </p>
</blockquote>

<p>This seems tricky to test. The game test doesn’t actually need to change. It seems testGame() is looking more and more like an integration test but we’ll come back to that. To test this new functionality we need to inspect the game logic somehow. Where is one place we can put it? In the Card implementation itself. It has all the information about itself and can match itself with another card. Not sure what we’ll do about wildcards but lets try it anyway. We have to match by either color or number.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCardLogic</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Card</span> <span class="n">green1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">GREEN</span><span class="o">);</span>
  <span class="nc">Card</span> <span class="n">red1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
  <span class="nc">Card</span> <span class="n">red2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
  <span class="nc">Card</span> <span class="n">blue4</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">BLUE</span><span class="o">);</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">green1</span><span class="o">.</span><span class="na">canBePlayedOn</span><span class="o">(</span><span class="n">red1</span><span class="o">)).</span><span class="na">isTrue</span><span class="o">();</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">red1</span><span class="o">.</span><span class="na">canBePlayedOn</span><span class="o">(</span><span class="n">red2</span><span class="o">)).</span><span class="na">isTrue</span><span class="o">();</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">red2</span><span class="o">.</span><span class="na">canBePlayedOn</span><span class="o">(</span><span class="n">blue4</span><span class="o">)).</span><span class="na">isFalse</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The IDE adds the method for us and we add some very simple logic.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canBePlayedOn</span><span class="o">(</span><span class="nc">Card</span> <span class="n">topCard</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">topCard</span><span class="o">.</span><span class="na">number</span> <span class="o">==</span> <span class="n">number</span> <span class="o">||</span> <span class="n">topCard</span><span class="o">.</span><span class="na">colour</span> <span class="o">==</span> <span class="n">colour</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now we need to know what the top card is. Another test.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPileTopCard</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Pile</span> <span class="n">pile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Pile</span><span class="o">();</span>
  <span class="n">pile</span><span class="o">.</span><span class="na">addCard</span><span class="o">(</span><span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">GREEN</span><span class="o">));</span>
  <span class="n">pile</span><span class="o">.</span><span class="na">addCard</span><span class="o">(</span><span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">RED</span><span class="o">));</span>
  <span class="n">pile</span><span class="o">.</span><span class="na">addCard</span><span class="o">(</span><span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">BLUE</span><span class="o">));</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">pile</span><span class="o">.</span><span class="na">topCard</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="k">new</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">Colour</span><span class="o">.</span><span class="na">BLUE</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Make that work, including an equals() method. Now how can we link it all up. Well, the player must play a card based on the current top card so presumably we need to pass that in to the Player.play() method. But wait, how can we test that method so deeply inside the game class. I had to go out for a walk to get inspired. I came up with the idea that what we need to test is that the pile is valid. If the pile is valid then the play logic is valid! Beautiful… and easy to test.</p>

<p><label for="ugly" class="margin-toggle"> ⊕</label><input type="checkbox" id="ugly" class="margin-toggle" /><span class="marginnote">Just noticed how ugly this is :/ </span></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">pile</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="na">getPile</span><span class="o">().</span><span class="na">cards</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pile</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">pile</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">canBePlayedOn</span><span class="o">(</span><span class="n">pile</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">))).</span><span class="na">isTrue</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now that worked beautifully, and with some coding the tests pass but I’m not happy. I noticed a bug in the game logic that was not detected by the tests. Players were picking up from the pile instead of the pack and then discarding back to the pile, in effect skipping a turn without picking a card from the pack. This is worrying especially since the next step is to develop that logic for the rest of the game. This is a weak point of my TDD skills right now. <a href="https://www.infoq.com/news/2007/05/tdd-sudoku">I’m not alone</a>. There are many examples of this kind of incremental algorithm development failing. Intuition tells me that a possible approach would be to extract the logic to a testable state machine. That’s a big design jump and not very TDD. I have my doubts. This is one of the main reasons for this post. I’m going to save the code as it stands to version control (I should have been doing that more) and sleep on it.</p>

<p>Continued <a href="notes-on-art-of-tdd-uno-part-2.html">here</a>.</p>


<div id="share-bar">

    <div class="share-buttons">
        Share this:
        <a  href="https://twitter.com/intent/tweet?text=Notes on the Art of TDD - Uno (Part 1)&url=https://johnhearn.github.io//articles/notes-on-art-of-tdd-uno-part-1"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Twitter" >
            <i class="fa-lg fab fa-twitter share-button"></i>
        </a>
        <a  href="https://www.linkedin.com/shareArticle?mini=true&url=https://johnhearn.github.io//articles/notes-on-art-of-tdd-uno-part-1&title=Notes on the Art of TDD - Uno (Part 1)&summary=&source=John Hearn"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on LinkedIn" >
            <i class="fa-lg fab fa-linkedin share-button"></i>
        </a>
        <a  href="mailto:?subject=Notes on the Art of TDD - Uno (Part 1)&amp;body=Check out this site https://johnhearn.github.io//articles/notes-on-art-of-tdd-uno-part-1"
            title="Share via Email" >
            <i class="fa-lg fa fa-envelope-open share-button"></i>
        </a>
    </div>

</div>

    </article>
    <span class="print-footer">Notes on the Art of TDD - Uno (Part 1) - May 15, 2017 - John Hearn</span>
    <footer>
  <hr class="slender">
  <ul class="footer-links">
    <li>
        <a href="https://twitter.com/johnhearnbcn">
        <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
        </span>
        </a>
    </li>
    <li>
        <a href="https://github.com/johnhearn">
        <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fab fa-github fa-stack-1x fa-inverse"></i>
        </span>
        </a>
    </li>
    <li>
        <a href="https://www.linkedin.com/in/john-hearn-599762b">
        <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
        </span>
        </a>
    </li>
    <li>
        <a href="mailto:hearn.john@gmail.com">
        <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-envelope-open fa-stack-1x fa-inverse"></i>
        </span>
        </a>
    </li>
</ul>

<div class="credits">
<span>&copy; 2025 &nbsp;&nbsp;JOHN HEARN</span></br> <br>
<span>This site created with the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme</a> for <a href="//jekyllrb.com">Jekyll</a>.</span> 
</div>  
</footer>
  </body>
</html>
